<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanePal API</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="container">
        <div class="content">
            <!-- Header -->
            <div class="header">
                <!--<img src="favicon.ico" class="logo">-->
                <h1 class="title">PlanePal API</h1>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <p class="stat-label">Server Count</p>
                    <p class="stat-value" id="serverCount">0</p>
                </div>
                <div class="stat-card">
                    <p class="stat-label">Member Count</p>
                    <p class="stat-value" id="memberCount">0</p>
                </div>
            </div>

            <!-- Buttons -->
            <div class="button-container">
                <button class="button button-refresh" onclick="handleRefresh(this)">
                    <span>Refresh</span>
                </button>
                <a href="https://github.com/DevJSTAR/planepal-api/blob/main/README.md" target="_blank" class="button button-learn">
                    Learn More
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                        <polyline points="15 3 21 3 21 9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('https://api.github.com/repos/DevJSTAR/planepal-api/contents/api/data.json');
                const data = await response.json();
                const decodedContent = JSON.parse(atob(data.content));
                return decodedContent;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const currentValue = Math.floor(progress * (end - start) + start);
                element.textContent = currentValue.toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        async function updateStats(animate = true) {
            const data = await fetchData();
            if (!data) return;

            const serverCountElement = document.getElementById('serverCount');
            const memberCountElement = document.getElementById('memberCount');

            if (animate) {
                animateValue(serverCountElement, 0, data.serverCount, 2000);
                animateValue(memberCountElement, 0, data.memberCount, 2000);
            } else {
                serverCountElement.textContent = data.serverCount.toLocaleString();
                memberCountElement.textContent = data.memberCount.toLocaleString();
            }
        }

        async function handleRefresh(button) {
            button.classList.add('loading');
            button.disabled = true;
            
            await updateStats(true); // Changed to true to trigger counting animation
            
            setTimeout(() => {
                button.classList.remove('loading');
                button.disabled = false;
            }, 2000);
        }

        // Initial load with animation
        updateStats(true);
    </script>
</body>
</html>
